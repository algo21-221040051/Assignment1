# Assignment 1
 
技术因子量化择时
刘瑞涵 221040051
Reference：《A股择时之技术面指标测试》——华泰研究

# 文章简介
华泰研究在文中研究了市场中常见的一些技术指标在A股的择时效应，技术因子包括动量类、均线类、相对强弱类，回测标的包括证指数、沪深 300、中证 500、上证 50、创业板指、深证成指、科创 50、中证 1000 八个 A 股主要宽基指数，并且文中还就技术指标的参数选择进行的研究，研究发现技术指标的默认参数一般具有更好的择时效果。

# 我的研究
研究出发点

通过详细研究华泰的研报，我认为文章存在一些可以优化的地方。

一是各个技术指标的使用。技术指标往往作为主观用法，交易的准则也千变万化，一种指标可能有很多种用法，可以跟其他指标结合使用，交易信号不一定固定，所以完全通过固定的逻辑触发指标的交易信号可能会存在问题。同时我发现，华泰研报中很多指标信号发出的准则都太过简单，而且有的甚至不太符合指标的使用逻辑，所以与其完全复现华泰对多个指标多个参数多个宽基指数的回测，我更想去对每个技术指标进行改进。

二是华泰在评判指标的择时效应时选用的是夏普比率等常见的策略评价指标，但是我认为从择时的角度出发，评判因子的效果更应该看重胜率。
# 研究内容
回测研究因子：ROC、MA、SMA、DMA、MACD、TRIX、BBI、BOLL、Aberration、BIAS、CCI、KDJ、RSI、CMO，以及自创的两个指标RHL、KING。
回测标的：上证指数
回测时期：2012年1月1日至2022年1月1日
回测逻辑：初始资金设为5000，交易手数设为1，手续费为0，只能做多，买入信号开单，每次只开一单，卖出信号平仓。
（其中BIAS、CCI、KDJ买入信号设的过于严格，所以在上证指数上没有发生交易。）
 
# 结论
通过结果可以看到，大多数调整后的技术指标择时效果都还是非常好，但是将其用到实盘中还需要做更多的研究与调整，可见的方向包括设定止损、多种不同类型的指标结合使用等。比如上面的KING指标就是我通过结合三种类型的一共5个指标组合起来的指标，目前只初步调整了一下，可以看到其胜率是所有指标中最高的。


# 因子附录（华泰版本）
动量类
ROC
变动率指标（ROC）是最简单、最经典的动量指标，通过“涨跌幅”这种最朴素的方式定 义了“动量（momentum）”。ROC 以当日的收盘价和 N 天前的收盘价比较，通过计算股价某一段时间内收盘价变动的比例，应用价格的移动比较来测量价位动量，探测股价买卖供需力量的强弱，进而分析股价的趋势，从而发出多空信号。指标构建方法为： 
ROC =（今收盘 - 前 N 周期收盘） / 前 N 周期收盘 * 100
其中，默认参数 N 取 10，即过去 10 日。 
 

使用方法：ROC与MAROC（比如ROC的5日均线）相比，上突破表示价格上行，下突破表示价格下行。

不能反映趋势方向，只能反映趋势运行中的节奏变化，

________________________________________

MTM
MTM 动力指标与 ROC 类似，指标构建方法为： 
MTM = 当期收盘价 - N 期前收盘价 
MAMTM = MTM 的 M 周期移动平均 
其中，默认参数：N=10，M=20
从构建方法来看，MTM 与 ROC 的主要区别在于是否除以前 N 期收盘价，即是否对股价的涨跌进行了标准化调整，我们认为 ROC 的调整更能体现出价格波动的幅度。 
 

使用方法：与ROC相似。

________________________________________

均线类
SMA
均线指标通过对价格取均值，提取出价格背后的趋势特征。单均线的定义即价格的 N1 日平均值，当价格高于均线，认为上升趋势；低于均线则认为下降趋势。双均线则在单均线的基础上，定义短期平均值（SMA）和长期平均值（LMA）二者的差值 DMA，通过将 DMA 与 0 相较，判断价格的运动趋势。从经验来看，双均线比单均线对趋势的判断更为稳定。 更进一步地，多条均线若满足短期均线高于长期均线，则称其形成了多头排列，是多方力量占优的表征。后续研究中我们重点考察单均线与双均线指标，SMA构建方法为：
SMA = N1 平均值（SMA）– N2 平均值（LMA）
其中，默认参数：N1=10, N2=20
 

使用方法：金叉死叉。

________________________________________

DMA
平行线差（DMA）指标是一种期限较长，稳定性高的均线指标。DMA 利用两条不同期间的平均线差值，来判断当前买卖能量的大小和未来价格趋势。与双均线 SMA 不同，此处 DMA 采用了均线的均线，进一步对 DMA 变量取期间平均值 
AMA指标构建方法为： 
DMA = N1 平均值–N2 平均值
AMA = DMA 的 N1 平均值
其中，默认参数：N1=10, N2=50
 

使用方法：通过将 DMA 与其均线 AMA 对比来判断多空信号，当前 DMA 高于均线则看多。
也有背离用法

________________________________________

MACD
平滑异同移动平均线（MACD）指标本质与 DMA 指标类似，根据长、短两条不同周期的平均线之间的离差值变化来研判行情，是对 DMA 的更进一步加工。与 DMA 不同在于，MACD 在第一次取移动平均值时采用了指数加权（EMA），通过赋予距今更近的数据点更高的权重， 一定程度上克服了等权平均带来的滞后性缺陷。
指标构建方法为： 
DIF = 短期 EMA - 长期 EMA
DEA = DIF 的移动平均值
MACD = 2 * (DIF - DEA) 
其中默认参数 short 取 12，即短期 EMA 的期限长度取过去 12 日；long 取 26，即长期 EMA 的期限长度取过去 26 日；mmid 取 9，即 DEA 计算时选用的期限长度取过去 9 日 
 

使用方法：
MACD金叉死叉
金叉：当短期快线DIF向上穿过长期慢线DEA时，属于做多金叉信号，需要进行“金叉+零轴”的综合考虑，0轴上方的金叉是强势上涨。
死叉：当短期快线DIF向下穿过长期慢线DEA时，属于做空死叉信号，死叉同样需要结合零轴，0轴下方的死叉是强势回调。
MACD背离
顶背离：价格的波峰一个比一个高，而MACD指标的波峰一浪比一浪低，形成MACD指标和K线趋势线方向相反状况。
底背离：价格的波谷一个比一个低，而MACD指标的波谷一浪比一浪高，形成MACD指标和K线趋势线方向相反状况。


TRIX
TRIX 趋向指标是一项超长周期的指标，波动频率较低，信号密度小，适用于进行长期控盘或投资。该指标的本质是一条三重指数平滑平均线，其构建方法为：
TR=收盘价的 N 日指数移动平均的 N 日指数移动平均的 N 日指数移动平均
TRIX=(TR-昨日 TR)/昨日 TR*100
MATRIX=TRIX 的 M 日简单移动平均
其中，默认参数 N 取 12，即计算三阶均线时采用 12 日的 EMA；M 取 9，即 MATRIX 使用 过去 9 日的简单移动平均值
 

使用方法：黑色线条为 TRIX，代表收盘价的 12 日三阶指数平均值，红色线条为 MATRIX， 即 TRIX 的 9 日均线。突破即为信号。

________________________________________

BBI
多空指标（BBI）是一种将不同日数移动平均线加权平均之后的均线型指标，本质上是一阶均线的混合，所以其既有短期移动平均线的灵敏，又有明显的中期趋势特征，适于稳健的投资者。BBI 指标一般选用 3 日、6 日、12 日、24 日等 4 条平均线，由于近期数据利用次数较多，远期数据利用次数较少，因而其实质上是一种变相的加权计算。其构建方法为： 
BBI = (N1 周期平均价+N2 周期平均价+N3 周期平均价+N4 周期平均价)/4 
其中，默认参数 N1=3, N2=6, N3=12, N4=24，分别代表四个周期的取值
 

使用方法：黑色线条即为 BBI 指标。与下图上半部分对比不难发现，BBI 指标兼具了上方不同周期 MA 曲线的特点。 

________________________________________

BOLL
布林线指标(BOLL) 又称布林带，是最为经典的通道类指标。其构建方法为： 
中线 MB = N 周期移动平均收盘价
偏移值 = P * N 周期收盘价的标准差
上轨 UP（阻力线）=中线+偏移值
下轨 DOWN（支撑线）=中线-偏移值
其中，默认参数 N 取 20，即过去 20 日； P 取 2，表示波带半径取标准差的 2 倍
 

使用方法：当股价穿越最外面的压力线（支撑线）时，表示卖点（买点）出现。当股价延着压力线（支撑线）上升（下降）运行，虽然股价并未穿越，但若回头突破第二条线即是卖点或买点。
1 根据K线是沿着布林带上下轨连续上涨还是在布林带中轨和上下轨之间震荡上涨来判断趋势是否强势，如果趋势很强势可以直接追涨，如果属于弱势趋势，可以逢低接多逢高抛空，把趋势的收益最大化。
2 帮助识别突破，现在股票和期货市场的假突破很多，用布林带可以做一个辅助判定，一般触及布林带上下轨的K线可以被看作是标志，当这根K线的高点或低点被突破了以后，往往行情就开始真正突破了。

________________________________________

BIAS
BIAS 乖离率用股价指数与移动平均线的比值关系，来描述股票价格与移动平均线之间的偏离程度的指标，其逻辑与布林带类似。BIAS 通过测算这一偏离程度，预测股价在剧烈波动时因偏离移动平均趋势而可能的回挡或反弹，以及股价在正常波动范围内移动而形成继续原有势的可信度。不过在实际回测中，基于反转的交易策略效果不佳，我们基于动量逻辑应用这一指标。其构建方法为： 
BIAS(N) =（收盘价 - N 周期移动平均价）/ N 周期移动平均价 * 100
其中，默认参数 N 常取 5，10，20
 

使用方法： 黑色、红色、蓝色线条分别为 N 取 5 日、10 日、20 日下的 BIAS 值。随着均线周期长度的增加，BIAS 指标的波动也相应上升。 

________________________________________

OSC
OSC 摆动量构造思想同 BIAS 相近，反映的是股价与移动平均价的偏离的绝对距离。其构建方法为： 
OSC = 当周期收盘价 - N 周期的平均线价
其中，默认参数 N=10 从构建方法来看，OSC 与 BIAS 的主要区别在于是否除以 N 周期移动平均价，即是否对股价的摆动进行了标准化调整，我们认为 BIAS 的调整更能体现出价格偏离的幅度，所以后续研究中，我们重点对 BIAS 指标进行实证分析。
 

使用方法：黑色线条为 N 取 10 日时的 OSC 值，红色线条为 OSC 的 5 日均线。 

________________________________________

B3612
B3612 乖离指标考虑不同周期的移动平均线之间的差距，3 日平均数值与 6 日平均数值之间的差值为 B36，6 日平均数值与 12 日平均数值之间的差值为 B612。该指标以长期均线为参考线，以短期均线为当前状态代表，衡量短期和中期投资者获利的相对状态，进而评估短、中期投资者对后市的看法。其构建方法为：
B36 = 最近 3 日的收盘价之和/3 - 最近 6 日的收盘价之和/6
B612 = 最近 6 日的收盘价之和/6 - 最近 12 日的收盘价之和/12
 

使用方法：黑色线条为 B36，红色线条为 B612。B3612 实际应用不广泛。 

________________________________________

CCI
顺势指标 CCI（Commodity Channel Index）衡量价格偏离其近期均值的程度。其构建方法为： 
TP = （最高价 + 最低价 +收盘价） / 3
MA = 最近 N 周期 TP 的累计和 / N
MD = （最近 N 周期（MA - TP）绝对值累计和） / N
CCI(N) = (TP - MA) / 0.015MD
其中，默认参数 N=14
 

使用方法：黑色线条为 CCI，在一定范围内波动。实际使用中，我们将 TP 简化为收盘价使用。 
1. 当CCI指标从下向上突破+100线而进入非常态区间时，表明股价脱离常态而进入异常波动阶段，中短线应及时买入，如果有较大的成交量配合，买入信号则更为可靠；
2. 当CCI指标从上向下突破-100线而进入另一个非常态区间时，表明股价的盘整阶段已经结束，将进入一个比较长的寻底过程，投资者应以持币观望为主；
3. 当CCI指标从上向下突破+100线而重新进入常态区间时，表明股价的上涨阶段可能结束，将进入一个比较长时间的盘整阶段，投资者应及时逢高卖出股票；
4. 当CCI指标从下向上突破-100线而重新进入常态区间时，表明股价的探底阶段可能结束，有将进入一个盘整阶段，投资者可以逢低少量买入股票；

 1、CCI指标上穿-100时可买入，反之跌破+100时卖出 
 2、专门挑选CCI在-220～-400的股票，如果股票创新低，指标没有创新低，(技术底背离)，股票马上将要上涨。当指标上穿-100时是最后买入点。 
 3、长期下跌后第一次碰-100不能买，第二次碰-100在即将上穿之时买入(必须底背离，成功率才99%)。 
 4、股价到+100时“加码”买入，在+100以上开始回头时跌破+100应该卖出，高位第二次穿过+100之时股价一般会创新高，但是指标如果背离时，再次跌破+100，坚决抛光! 
 5、再次到-100以下时，就重复上面的方法。但是在+100以上再回头，就不建议买入了 
 6、此指标周期(日、周、月、45天)越长越准确。 
 由于CCI指标没有钝化现象，如果股票处于强势拉升阶段，只要CCI没有跌破+100就可以坚决持股，以免放走大牛;如果股价处于超弱势打压阶段，CCI指标虽然出现底背离，只要没有攻上-100，则坚决不抄底。这个就为操作得到了更加有力的依据。 

________________________________________

相对强弱类
W&R
威廉指标 W&R（William 's Overbought/Oversold Index）是最为简易的测量超买、超卖程度的指标，以过去一段时间的最高价和最低价划定波动范围，用于分析市场短期买卖走势。 其构建方法为： 
H = 基期内最高价
L = 基期内最低价
C = 当日收盘价
WR = （H - C） / （H - L） * 100
其中，默认参数取 N=10，即基期长度定为 10 日
 

使用方法：黑色线条为 WR，可以看出其反映当日收盘价在过去 10 日内的相对高低，收盘价相对高则 WR 值低，取值范围为 0-100。 
（鉴于威廉指标实际应用较少，故该指标并未纳入实证研究范畴。)

________________________________________

KDJ
随机指标 KDJ 是目前中国股市最普及的指标之一。KDJ 通过一个特定的周期（常为 9 日、 9 周等）内出现过的最高价、最低价及最后一个计算周期的收盘价及这三者之间的比例关系， 来计算最后一个计算周期的未成熟随机值 RSV，然后采用指数加权移动平均线的方法来计算一阶均线 K 值、二阶均线 D 值以及前二者之差 J 值，并绘成曲线图来研判股票走势。其具体构建方法为： 
 RSV =（收盘价－最近 N 日最低价）/（最近 N 日最高价 - 最近 N 日最低价） × 100
K 线：K 值 = (M1-1)/M1 * 前一日 K 值 + 1/M1 * 当日 RSV
D 线：D 值 = (M2-1)/M2 * 前一日 D 值 + 1/M2 * 当日 K 值
J 线：3 × 当日 K 值 － 2 × 当日 D 值
其中，默认参数 N=9，即取最近 9 日作为基期； M1=3，M2=3，即两次指数加权移动平均构造过程均采用 3 作为共同的权重因子。 
 

使用方法：黑色线条为 K 值，红色线条为 D 值，蓝色线条为 J 值。可以看出 D 值作为 K 值的均线更为平滑，而 J 值衡量 K 值与 D 值间的相对距离，起到了放大效果。

1. 按对价格的敏感程度，J线最高，D线次之，最不敏感是K线，意思就是，比如价格上涨，首先会跟随上涨的，是J线，以此类推。
2.KDJ会在0-100内穿行，但是也会出现J线在100以上，0以下的负数值
2.在MACD,RSI,KDJ等一系列同属性指标里面，KDJ是最敏感的摆动指标，其单独作用力并不好，我建议是和其他的一些技术相结合，效果会更好。
3.该指标也是价格先，指标后，价格决定指标，其一些固有特点上，会使得指标的状态，运行方式上，能够起到一些预示价格的作用，用法也就随之产生。

如果K、D、J值都大于50时，为多头市场，后市看涨；如果K、D、J值都小于50时，为空头市场，后市看空。
KDJ指标图形中，D曲线运行速度最慢，敏感度最低；其次是K曲线，J曲线敏感度最强。
当J大于K、K大于D时，即3条指标曲线呈多头排列，显示当前为多头市场；当3条指标出现黄金交叉时，指标发出买入信号。
当3条指标曲线呈空头排列时，表示短期是下跌趋势；3条曲线出现死亡交叉时，指标发出卖出信号。
如果KD线交叉突破反复在50左右震荡，说明行情正在整理，此时要结合J值，观察KD偏离的动态，再决定投资行动。

________________________________________

RSI
RSI 指标是经典的相对强弱指标，根据供求平衡的原理，通过测量某一个期间内股价上涨总幅度占股价变化总幅度平均值的百分比，来评估多空力量的强弱程度，进而释放多空信号。 其构建方法为： 
RSI = N 日内收盘价上涨幅度累计 / N 日内收盘价上涨及下跌幅度累计 * 100
其中，默认参数 N 常取 6 日或 12 日
 

使用方法：黑色线条为 N 取 6 日时的 RSI 值，红色线条为 N 取 12 日时的 RSI 值，后者由于对应周期长而更为平滑。 
可衍生引入 CMO 指标，该指标与 RSI 指标构建方式类似，分母相同， 将分子替换为 N 日内收盘价涨跌幅度之差。 

